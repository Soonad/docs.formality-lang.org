

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Box System &mdash; Formality 0.3.91 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Theorem Proving" href="8.Theorem-Proving.html" />
    <link rel="prev" title="5. Datatypes" href="5.Datatypes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #444053" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/formality-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.91
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Language</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1.Motivation.html">1. Motivation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="1.Motivation.html#optimal-substitutions">1.1. Optimal substitutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.Motivation.html#a-perfect-execution-model">1.2. A “perfect” execution model</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.Motivation.html#a-powerful-type-theory">1.3. A powerful type-theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2.Installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.Hello,-world!.html">3. Hello, World!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3.Hello,-world!.html#running-a-program">3.1. Running a program</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.Hello,-world!.html#imports">3.2. Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.Hello,-world!.html#global-imports">3.3. Global imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.Hello,-world!.html#evaluating">3.4. Evaluating</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.Hello,-world!.html#type-checking">3.5. Type-checking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4.Basics.html">4. Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="4.Basics.html#let">4.1. Let</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.Basics.html#words">4.2. Words</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.Basics.html#if">4.3. If</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.Basics.html#pairs">4.4. Pairs</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.Basics.html#functions">4.5. Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="5.Datatypes.html">5. Datatypes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#simple-datatypes">5.1. Simple datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#container-datatypes">5.2. Container datatypes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="5.Datatypes.html#nested-cases">5.2.1. Nested cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#recursive-datatypes">5.3. Recursive datatypes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="5.Datatypes.html#recursive-functions">5.3.1. Recursive functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#polymorphic-datatypes">5.4. Polymorphic datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#indexed-datatypes">5.5. Indexed datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="5.Datatypes.html#self-encodings">5.6. Self-Encodings</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Box System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#avoid-making-a-copy">6.1. Avoid making a copy.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#use-case-d-arguments">7. Use case’d arguments.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#make-a-manual-copy">7.1. Make a manual copy.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-boxes">7.2. Use boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loops-and-recursion">7.3. Loops and Recursion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="8.Theorem-Proving.html">8. Theorem Proving</a><ul>
<li class="toctree-l2"><a class="reference internal" href="8.Theorem-Proving.html#equality">8.1. Equality</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.Theorem-Proving.html#simple-proofs">8.2. Simple proofs</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.Theorem-Proving.html#inductive-proofs">8.3. Inductive proofs</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../runtime/Formality-Net.html">1. Formality Net</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../runtime/Formality-Net.html#rewrite-rules">1.1. Rewrite rules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#erasure">1.1.1. Erasure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#substitution">1.1.2. Substitution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#duplication">1.1.3. Duplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#if-then-else">1.1.4. If-Then-Else</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#num-operation">1.1.5. Num-Operation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runtime/Formality-Net.html#compiling-fm-core-to-fm-net">1.2. Compiling FM-Core to FM-Net</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime/Formality-Net.html#implementation">1.3. Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#rewrites">1.3.1. Rewrites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#strict-evaluation">1.3.2. Strict evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime/Formality-Net.html#lazy-evaluation">1.3.3. Lazy evaluation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Formality</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>6. Box System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/language/6.7.Boxes.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="box-system">
<h1>6. Box System<a class="headerlink" href="#box-system" title="Permalink to this headline">¶</a></h1>
<p>Formality’s approach to termination is what makes it different from other proof languages like Agda, Idris and Coq. Instead of having native datatypes, structural recursion and so on, we go deeper and change the underlying logic of the system from intuitionist to elementary affine. This is responsible for all the claimed benefits of Formality: optimal reductions, no garbage-collection, massive parallelism, elegant inductive types and so on. But it comes with a huge tradeoff: our lambdas are affine, i.e., bound variables can’t be used more than once. This limits what we can do in multiple ways. For example, we can’t write a function that multiples a <code class="docutils literal notranslate"><span class="pre">Word</span></code> by itself:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">square</span> <span class="o">:</span> <span class="p">{</span><span class="nx">x</span> <span class="o">:</span> <span class="nx">Word</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="nx">Word</span>
  <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span>

<span class="nx">main</span> <span class="o">:</span> <span class="nx">Word</span>
  <span class="nx">square</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>If we try, we get an error:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Lambda variable <span class="sb">`</span>x<span class="sb">`</span> used more than once in:
<span class="o">{</span>x<span class="o">}</span> <span class="o">=</span>&gt; <span class="o">(</span>x * x<span class="o">)</span>
</pre></div>
</div>
<p>This can be amended in multiple ways.</p>
<div class="section" id="avoid-making-a-copy">
<h2>6.1. Avoid making a copy.<a class="headerlink" href="#avoid-making-a-copy" title="Permalink to this headline">¶</a></h2>
<p>Suppose we were trying to implement this function:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>inc_if : {b : Bool, x : Word} -&gt; Word
  @Bool b ~&gt; Word
  | true  =&gt; x + 1
  | false =&gt; x + 0

main : Word
  inc_if(true, 10)
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">inc_if</span></code> increments a number if a boolean is true. Since <code class="docutils literal notranslate"><span class="pre">x</span></code> is used in different branches, we could avoid copying it by adding an extra lambda:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>inc_if : {b : Bool, x : Word} -&gt; Word
  (@ b    ~&gt; {x : Word} -&gt; Word
  | true  =&gt; {x} x + 1
  | false =&gt; {x} x + 0)(x)

main : Word
  inc_if(true, 10)
</pre></div>
</div>
<p>That is, instead of using <code class="docutils literal notranslate"><span class="pre">x</span></code> inside each case of the pattern-match, we return a function that receives <code class="docutils literal notranslate"><span class="pre">x</span></code> and use it in the body of the function.</p>
</div>
</div>
<div class="section" id="use-case-d-arguments">
<h1>7. Use case’d arguments.<a class="headerlink" href="#use-case-d-arguments" title="Permalink to this headline">¶</a></h1>
<p>The optimization above is powerful, but it comes at the cost of added code complexity. The case’d argument feature will automatically perform it, allowing you to use an argument more than once, as long as it is in a different branch. For example, this function is not valid:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>data Bool
| true
| false

// Gets first element if `b` true, otherwise gets the second
getter : {b : Bool, pair : [:Word, Word]} -&gt; Word
  case/Bool b
  | true  =&gt; snd(pair)
  | false =&gt; fst(pair)
  : Bool
</pre></div>
</div>
<p>Because the <code class="docutils literal notranslate"><span class="pre">pair</span></code> argument is used more than once. With <code class="docutils literal notranslate"><span class="pre">case</span></code>’d arguments, the language moves <code class="docutils literal notranslate"><span class="pre">pair</span></code> to each branch without duplications, allowing you to write just:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">data</span> <span class="nx">Bool</span>
<span class="o">|</span> <span class="kc">true</span>
<span class="o">|</span> <span class="kc">false</span>

<span class="c1">// Gets first element if `b` true, otherwise gets the second</span>
<span class="nx">getter</span> <span class="o">:</span> <span class="p">{</span><span class="k">case</span> <span class="nx">b</span> <span class="o">:</span> <span class="nx">Bool</span><span class="p">,</span> <span class="nx">pair</span> <span class="o">:</span> <span class="p">[</span><span class="o">:</span><span class="nx">Word</span><span class="p">,</span> <span class="nx">Word</span><span class="p">]}</span> <span class="o">-&gt;</span> <span class="nx">Word</span>
<span class="o">|</span> <span class="kc">true</span>  <span class="p">=&gt;</span> <span class="nx">fst</span><span class="p">(</span><span class="nx">pair</span><span class="p">)</span>
<span class="o">|</span> <span class="kc">false</span> <span class="p">=&gt;</span> <span class="nx">snd</span><span class="p">(</span><span class="nx">pair</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="make-a-manual-copy">
<h2>7.1. Make a manual copy.<a class="headerlink" href="#make-a-manual-copy" title="Permalink to this headline">¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">Word</span></code>s in particular, there is a native <code class="docutils literal notranslate"><span class="pre">cpy</span></code> operation that copies it as many times as desired:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">square</span> <span class="o">:</span> <span class="p">{</span><span class="nx">x</span> <span class="o">:</span> <span class="nx">Word</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="nx">Word</span>
  <span class="nx">cpy</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span>
  <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span>

<span class="nx">main</span> <span class="o">:</span> <span class="nx">Word</span>
  <span class="nx">square</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>For everything else, you can write an auxiliary <code class="docutils literal notranslate"><span class="pre">copy</span></code> function:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>copy : {b : Bool} -&gt; [:Bool, Bool]
  @ b     =&gt; [:Bool, Bool]
  | true  =&gt; [true, true]
  | false =&gt; [false, false]

and_itself : {b : Bool} -&gt; Bool
  get [b0, b1] = copy(b)
  and(b0, b1)
</pre></div>
</div>
</div>
<div class="section" id="use-boxes">
<h2>7.2. Use boxes<a class="headerlink" href="#use-boxes" title="Permalink to this headline">¶</a></h2>
<p>Formality has a primitive for deep-copying values, boxes.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>syntax</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code># a</code></td>
<td>Puts the closed term <code>a</code> inside a box</td>
</tr>
<tr>
<td><code>! A</code></td>
<td>The type of a boxed term</td>
</tr>
<tr>
<td><code>dup x = #a ...</code></td>
<td>Removes <code>a</code> from its box and makes <code>n</code> copies of it as <code>x</code></td>
</tr>
</tbody>
</table><p>But this primitive, without restriction, would be very dangerous. For example, this program:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>main
  let f = {x}
    dup x = x
    x(#x)
  f(#f)
</pre></div>
</div>
<p>Would loop forever, which should never happen in a terminating language. To solve that, Formality relies on the <strong>stratification condition</strong>. It, in short, enforces the following invariant:</p>
<blockquote>
<div>The level a term can never change during the program evaluation.</div></blockquote>
<p>Where the level of a term is the number of boxes (<code class="docutils literal notranslate"><span class="pre">#</span></code>s) wrapping it on the syntax tree. For example, here:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>[&quot;a&quot;, [#&quot;b&quot;, #[#&quot;c&quot;, ##&quot;d&quot;]]]
</pre></div>
</div>
<p>The string <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> isn’t wrapped by any box. As such, it is on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">0</span></code>. The string <code class="docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code> is wrapped by one box, so it is on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code>. The entire <code class="docutils literal notranslate"><span class="pre">[#&quot;c&quot;,</span> <span class="pre">##&quot;d&quot;]</span></code> pair is wrapped by one box, so, <code class="docutils literal notranslate"><span class="pre">&quot;c&quot;</span></code> is wrapped by 2 boxes in total and, thus, is on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">2</span></code>, while <code class="docutils literal notranslate"><span class="pre">&quot;d&quot;</span></code> is wrapped by 3 boxes in total and, thus, is on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">3</span></code>.</p>
<p>This condition forbids certain programs from being accepted. For example, this one:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>box : {x : Word} -&gt; !Word 
  # x
</pre></div>
</div>
<p>Isn’t allowed because, if it was, we would be able to increase the level of a word. Similarly, this one:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>main : [:Word, Word]
  dup x = #42
  [x, x]
</pre></div>
</div>
<p>Isn’t allowed, because <code class="docutils literal notranslate"><span class="pre">42</span></code> would jump from <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">0</span></code> during runtime. But this one is fine:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>main : ![:Word, Word]
  dup x = #42
  # [x, x]
</pre></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">42</span></code> remains on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code> after being copied. This one is fine too:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>main : [:!Word, !Word]
  dup x = #42
  [#x, #x]
</pre></div>
</div>
<p>For the same reason.</p>
<p>Boxes aren’t very useful for copying data, because information can only flow from lower to higher levels. Since a term triggering a <code class="docutils literal notranslate"><span class="pre">dup</span></code> must be one level below the term copied, it won’t be able to read the results of that copy. But they are very useful for implementing things like (bounded) loops and recursion, without causing the language to be non-terminating.</p>
</div>
<div class="section" id="loops-and-recursion">
<h2>7.3. Loops and Recursion<a class="headerlink" href="#loops-and-recursion" title="Permalink to this headline">¶</a></h2>
<p>To show how bounded loops and recursion can be implemented with boxes, observe the following program:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>ten_times : {~T : Type, f : !{x : T} -&gt; T, x : !T} -&gt; !T
  dup f = f
  dup x = x
  # f(f(f(f(f(f(f(f(f(f(x))))))))))

main : !Word
  ten_times(~Word, #{x} x + 2, #0)
</pre></div>
</div>
<p>Here, we define a function, <code class="docutils literal notranslate"><span class="pre">ten_times</span></code>, which takes a function, <code class="docutils literal notranslate"><span class="pre">f</span></code>, creates 10 copies of it, and applies to an argument, <code class="docutils literal notranslate"><span class="pre">x</span></code>. As the result, we’re able to repeat the <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">2</span></code> operation 10 times, adding <code class="docutils literal notranslate"><span class="pre">20</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code>. This same technique can be used to implement bounded recursion. For example, here:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>ten_times : {~T : Type, f : !{x : T} -&gt; T, x : !T} -&gt; !T
  dup f = f
  dup x = x
  # f(f(f(f(f(f(f(f(f(f(x))))))))))

fact : !{n : Word} -&gt; Word
  let call = {rec, i}
    cpy i = i
    if i === 0:
      1
    else:
      (i * rec(i - 1))
  let halt = {i}
    0
  ten_times(~{x : Word} -&gt; Word, #call, #halt)

main : !Word
  dup fact = fact
  # fact(6)
</pre></div>
</div>
<p>We “emulate” a recursive function by using <code class="docutils literal notranslate"><span class="pre">ten_times</span></code> to “build” the recursion tree of “fact” up to 10 layers deep. As such, it only works for inputs up to 10; after that, it hits the “halt” case and returns 0. The good thing about this way of doing recursion is that we’re not limited to recurse on structurally smaller arguments. The bad thing is that it is a little bit verbose, requiring an explicit bound, and a halting case for when the function “runs out of gas”. Moreover, since we used <code class="docutils literal notranslate"><span class="pre">ten_times</span></code> to make the function, it comes inside a box, on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code>. In other words, it is impossible to use it on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">0</span></code>! Instead, we must use the <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">0</span></code> to unbox it (with a <code class="docutils literal notranslate"><span class="pre">dup</span></code>), and then use it on <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code>.</p>
<p>Fortunately, since bounded recursive functions are so common, Formality has built-in syntax for them, relying on “boxed definitions”. To make a boxed definition, simply annotate it with a <code class="docutils literal notranslate"><span class="pre">!</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">:</span></code>. That has several effects. First, the whole definition is lifted to <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">1</span></code>. Second, it allows you to use boxed definitions inside <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>s: the parser will automatically unbox them for you. Third, the definition can call itself recursively; if it does, then Formality will assembling the recursion for you using a <code class="docutils literal notranslate"><span class="pre">Ind</span></code> implementation from the Base library. This is an example of usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nx">fact</span><span class="o">*</span><span class="nx">n</span> <span class="o">:</span> <span class="o">!</span> <span class="p">{</span><span class="nx">i</span> <span class="o">:</span> <span class="nx">Word</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="nx">Word</span>
  <span class="nx">cpy</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span>
  <span class="k">if</span> <span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span><span class="o">:</span>
    <span class="mi">1</span>
  <span class="k">else</span><span class="o">:</span>
    <span class="nx">i</span> <span class="o">*</span> <span class="nx">fact</span><span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">*</span> <span class="mi">0</span>
  
<span class="o">!</span><span class="nx">main</span> <span class="o">:</span> <span class="o">!</span><span class="nx">Word</span>
  <span class="o">&lt;</span><span class="nx">fact</span><span class="o">*</span><span class="mi">100</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the halting case was defined with a <code class="docutils literal notranslate"><span class="pre">*</span></code> on the end. If it coincided with one of the function’s arguments, you could place a <code class="docutils literal notranslate"><span class="pre">*</span></code> before it instead, i.e., <code class="docutils literal notranslate"><span class="pre">fact</span> <span class="pre">!</span> <span class="pre">{*i</span> <span class="pre">:</span> <span class="pre">Word}</span> <span class="pre">-&gt;</span> <span class="pre">Word</span></code>. Note also that, since <code class="docutils literal notranslate"><span class="pre">main</span></code> uses a recursive function, it must itself be a boxed definition, annotated with <code class="docutils literal notranslate"><span class="pre">!</span></code>. Alternatively, you could make it a normal definition and perform the unboxing yourself:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>main : !Word
  dup fact = fact
  # fact*100(12)
</pre></div>
</div>
<p>Both are equivalent.</p>
<p>The maximum recursion depth of the <code class="docutils literal notranslate"><span class="pre">Ind</span></code> defined by the base library is <code class="docutils literal notranslate"><span class="pre">2^256-1</span></code>. In other words, despite being terminating, in practice, Formality is capable of doing anything a Turing-complete language could do. After all, no language could perform more than <code class="docutils literal notranslate"><span class="pre">2^256-1</span></code> calls without exhausting your computer (or this universe’s) resources.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="8.Theorem-Proving.html" class="btn btn-neutral float-right" title="8. Theorem Proving" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="5.Datatypes.html" class="btn btn-neutral float-left" title="5. Datatypes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ethereum Foundation and Sunshine Cybernetics

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>